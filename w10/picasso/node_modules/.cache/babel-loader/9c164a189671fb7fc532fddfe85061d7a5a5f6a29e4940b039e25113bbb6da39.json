{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport React, { forwardRef, useEffect, useRef, useCallback } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Dialog } from '@material-ui/core';\nimport cx from 'classnames';\nimport { usePicassoRoot, useBreakpoint } from '@toptal/picasso-provider';\nimport { CloseMinor16 } from '../Icon';\nimport useCombinedRefs from '../utils/use-combined-refs';\nimport { ModalManager } from '../utils/Modal';\nimport ButtonCircular from '../ButtonCircular';\nimport styles from './styles';\nimport ModalContext from './ModalContext';\nimport { useBodyScrollLock } from '../utils/use-body-scroll-lock';\nconst useStyles = makeStyles(styles, {\n  name: 'PicassoModal'\n});\nconst defaultManager = new ModalManager();\n// https://github.com/udacity/ud891/blob/gh-pages/lesson2-focus/07-modals-and-keyboard-traps/solution/modal.js#L25\n// found in https://developers.google.com/web/fundamentals/accessibility/focus/using-tabindex\nconst focusableElementsString = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex=\"0\"], [contenteditable]';\nconst tooltipContainerString = '[role=tooltip]';\nconst focusFirstFocusableElement = node => {\n  const elements = node.querySelectorAll(focusableElementsString);\n  // Convert NodeList to Array\n  const focusableElements = Array.prototype.slice.call(elements);\n  focusableElements[0].focus();\n};\nconst isFocusInsideModal = modalNode => {\n  const modalContainsFocusedElement = modalNode.contains(document.activeElement);\n  if (modalContainsFocusedElement) {\n    return true;\n  }\n  return false;\n};\nconst isFocusInsideTooltip = () => {\n  const tooltipContainers = document.querySelectorAll(tooltipContainerString);\n  if (tooltipContainers.length === 0) {\n    return false;\n  }\n  const tooltipContainsFocusedElement = Array.from(tooltipContainers).some(container => container.contains(document.activeElement));\n  if (tooltipContainsFocusedElement) {\n    return true;\n  }\n  return false;\n};\nconst generateKey = (() => {\n  let count = 0;\n  return () => ++count;\n})();\n// eslint-disable-next-line react/display-name\nexport const Modal = forwardRef(function Modal(props, ref) {\n  const {\n      children,\n      open,\n      size = 'medium',\n      onBackdropClick,\n      onClose,\n      onOpen,\n      className,\n      style,\n      container,\n      hideBackdrop = false,\n      transitionDuration = 300,\n      paperProps,\n      align = 'centered',\n      testIds,\n      transitionProps,\n      disableBackdropClick = false\n    } = props,\n    rest = __rest(props, [\"children\", \"open\", \"size\", \"onBackdropClick\", \"onClose\", \"onOpen\", \"className\", \"style\", \"container\", \"hideBackdrop\", \"transitionDuration\", \"paperProps\", \"align\", \"testIds\", \"transitionProps\", \"disableBackdropClick\"]);\n  const classes = useStyles(props);\n  const picassoRootContainer = usePicassoRoot();\n  const rootRef = useCombinedRefs(ref, useRef(null));\n  const modalId = useRef(generateKey());\n  useEffect(() => {\n    const handleDocumentFocus = () => {\n      if (!defaultManager.isTopModal(modalId.current)) {\n        return;\n      }\n      if (!rootRef || !rootRef.current) {\n        return;\n      }\n      if (isFocusInsideModal(rootRef.current)) {\n        return;\n      }\n      if (isFocusInsideTooltip()) {\n        return;\n      }\n      focusFirstFocusableElement(rootRef.current);\n    };\n    if (!open) {\n      return;\n    }\n    document.addEventListener('focus', handleDocumentFocus, true);\n    return () => {\n      document.removeEventListener('focus', handleDocumentFocus, true);\n    };\n  }, [open, rootRef]);\n  useEffect(() => {\n    const currentModalId = modalId.current;\n    if (open) {\n      defaultManager.add(currentModalId);\n    }\n    return () => {\n      defaultManager.remove(currentModalId);\n    };\n  }, [open]);\n  useBodyScrollLock(open);\n  const isSmall = useBreakpoint('small');\n  const handleClose = useCallback((_event, reason) => {\n    if (reason === 'escapeKeyDown' && onClose) {\n      onClose();\n    } else if (reason === 'backdropClick' && !disableBackdropClick) {\n      if (onBackdropClick) {\n        onBackdropClick();\n      }\n      if (onClose) {\n        onClose();\n      }\n    }\n  }, [disableBackdropClick, onBackdropClick, onClose]);\n  return React.createElement(Dialog, Object.assign({}, rest, {\n    ref: rootRef,\n    classes: {\n      root: classes.root,\n      container: classes.container,\n      paper: cx(classes.paper, classes[size], {\n        [classes.topAlignedDialog]: align === 'top'\n      })\n    },\n    className: className,\n    style: style,\n    fullScreen: isSmall,\n    container: container || picassoRootContainer,\n    PaperProps: Object.assign(Object.assign({}, paperProps), {\n      elevation: 2\n    }),\n    hideBackdrop: hideBackdrop,\n    onClose: handleClose,\n    onEnter: onOpen,\n    open: open,\n    transitionDuration: transitionDuration,\n    maxWidth: false,\n    disableEnforceFocus // we need our own mechanism to keep focus inside the Modals\n    : true,\n    TransitionProps: transitionProps\n  }), React.createElement(ModalContext.Provider, {\n    value: true\n  }, children), onClose && React.createElement(ButtonCircular, {\n    variant: 'flat',\n    className: classes.closeButton,\n    onClick: onClose,\n    \"data-testid\": testIds === null || testIds === void 0 ? void 0 : testIds.closeButton\n  }, React.createElement(CloseMinor16, null)));\n});\nModal.defaultProps = {\n  hideBackdrop: false,\n  disableBackdropClick: false,\n  size: 'medium',\n  transitionDuration: 300,\n  align: 'centered'\n};\nModal.displayName = 'Modal';\nexport default Modal;","map":{"version":3,"names":["React","forwardRef","useEffect","useRef","useCallback","makeStyles","Dialog","cx","usePicassoRoot","useBreakpoint","CloseMinor16","useCombinedRefs","ModalManager","ButtonCircular","styles","ModalContext","useBodyScrollLock","useStyles","name","defaultManager","focusableElementsString","tooltipContainerString","focusFirstFocusableElement","node","elements","querySelectorAll","focusableElements","Array","prototype","slice","call","focus","isFocusInsideModal","modalNode","modalContainsFocusedElement","contains","document","activeElement","isFocusInsideTooltip","tooltipContainers","length","tooltipContainsFocusedElement","from","some","container","generateKey","count","Modal","props","ref","children","open","size","onBackdropClick","onClose","onOpen","className","style","hideBackdrop","transitionDuration","paperProps","align","testIds","transitionProps","disableBackdropClick","rest","__rest","classes","picassoRootContainer","rootRef","modalId","handleDocumentFocus","isTopModal","current","addEventListener","removeEventListener","currentModalId","add","remove","isSmall","handleClose","_event","reason","createElement","Object","assign","root","paper","topAlignedDialog","fullScreen","PaperProps","elevation","onEnter","maxWidth","disableEnforceFocus","TransitionProps","Provider","value","variant","closeButton","onClick","defaultProps","displayName"],"sources":["../../src/Modal/Modal.tsx"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}