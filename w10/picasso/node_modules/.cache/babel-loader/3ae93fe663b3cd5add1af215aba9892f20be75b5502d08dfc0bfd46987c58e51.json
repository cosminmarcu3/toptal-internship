{"ast":null,"code":"import { createRef, useEffect, useMemo, useRef, useState } from 'react';\nconst getDynamicNodes = nodes => {\n  return nodes.map(node => {\n    return Object.assign(node, {\n      ref: createRef(),\n      rect: {\n        width: 0,\n        height: 0\n      }\n    });\n  });\n};\nconst updateNodesXorYPosition = (nodes, direction, verticalMargin, horizontalMargin) => {\n  return nodes.sort((left, right) => left.depth - right.depth).map(node => {\n    if (!node.ref.current || !node.ref.current.firstElementChild || !node.ref.current.firstElementChild.firstElementChild) {\n      return node;\n    }\n    const {\n      offsetWidth: width,\n      offsetHeight: height\n    } = node.ref.current.firstElementChild.firstElementChild;\n    if (!height || !width) {\n      return node;\n    }\n    if (direction === 'horizontal') {\n      node.x = 0;\n    } else {\n      node.y = 0;\n    }\n    node.rect = {\n      width,\n      height\n    };\n    if (node.parent) {\n      const positionDeltas = {\n        horizontal: node.parent.x + node.parent.rect.width + horizontalMargin,\n        vertical: node.parent.y + node.parent.rect.height + verticalMargin\n      };\n      if (direction === 'horizontal') {\n        node.x = positionDeltas[direction];\n      } else {\n        node.y = positionDeltas[direction];\n      }\n    }\n    return node;\n  });\n};\n/**\n * That hook expects the rootNode of the tree and returns the list of nodes with predefined position values\n * Coz, the exact node contains the ReactElement, so it's not clear the real sizes of the node before the rendering.\n * That hook handles that problem by listening the changes from the render and recalculating positions.\n * Also, the data of the `rootNode` can be changed — that hook handles it as well.\n */\nexport const useNodes = (rootNode, direction, verticalMargin, horizontalMargin) => {\n  const [initialized, setInitializedState] = useState(false);\n  const initialNodes = useRef();\n  // we only need to prepare initial nodes once, on a first render\n  if (!initialNodes.current) {\n    initialNodes.current = getDynamicNodes(rootNode.descendants());\n  }\n  const dynamicNodes = useMemo(() => {\n    const latestNodes = rootNode.descendants();\n    if (!initialNodes.current) {\n      return [];\n    }\n    return initialNodes.current.map(node => {\n      const foundNode = latestNodes.find(latestNode => latestNode.data.id === node.data.id);\n      if (!foundNode) {\n        return node;\n      }\n      return Object.assign(node, {\n        data: foundNode.data\n      });\n    });\n  }, [rootNode, initialNodes]);\n  const nodes = useMemo(() => {\n    return updateNodesXorYPosition(dynamicNodes, direction, verticalMargin, horizontalMargin);\n    // we have to render nodes twice: first for the initial showing data, and the second one — with the correct positions.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dynamicNodes, initialized, direction, verticalMargin, horizontalMargin]);\n  useEffect(() => {\n    if (!dynamicNodes[0].ref.current || initialized) {\n      return;\n    }\n    // as soon as `ref.current` appears, we can take positions for each node\n    setInitializedState(true);\n  }, [dynamicNodes, initialized]);\n  return nodes;\n};","map":{"version":3,"names":["createRef","useEffect","useMemo","useRef","useState","getDynamicNodes","nodes","map","node","Object","assign","ref","rect","width","height","updateNodesXorYPosition","direction","verticalMargin","horizontalMargin","sort","left","right","depth","current","firstElementChild","offsetWidth","offsetHeight","x","y","parent","positionDeltas","horizontal","vertical","useNodes","rootNode","initialized","setInitializedState","initialNodes","descendants","dynamicNodes","latestNodes","foundNode","find","latestNode","data","id"],"sources":["../../src/TreeView/useNodes.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}